<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <div>
        <h3>단일 파일업로드</h3>
        <form id="form1">
            <input type="file" name="file">
            <button type="button">Upload</button>
        </form>
    </div>

    <div>
        <h3>다중 파일업로드</h3>
        <form id="form2">
            <input type="file" id="fileList"  name="files" multiple>
            <button type="button">Upload</button>
        </form>
    </div>
<script>
    function regist() {
        const formData = new FormData(document.getElementById("form1"));

        // 비동기로 파일을 전송할때는 data 타입을 false로 두어야 된다(자동으로 못 바꾸도록)
        $.ajax({
            url: "/file/upload",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                console.log(data);
            },
            error: function (data) {
                console.log(data)
            }
        })

    }

    function registMulti() {
        const formData = new FormData();

        console.log("파일 수 : ", document.getElementById("fileList").files.length);

        for(const file of document.getElementById("fileList").files) {
            //ajax의 비동기 업로드를 위해 formData에 유저가 선택한 파일들을 옮겨심자
            formData.append("files", file); // files라는 파라미터명을 이용하여 배열 생성
        }

        $.ajax({
            url: "/file/upload",
            method:"POST",
            data:formData,
            processData: false,
            contentType: false,
            success: function (data) {
                console.log(data);
            },
            error: function (data) {
                console.log(data)
            }
        })
    }


    // 단일 파일업로드
    $("#form1 button").click(() => {
        regist();
    })

    // 다중 파일업로드
    $("#form2 button").click(() => {
        registMulti();
    })
</script>
</body>
</html>